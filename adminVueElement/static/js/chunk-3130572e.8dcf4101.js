(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3130572e"],{6901:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page-role-manage"},[n("el-button",{staticStyle:{"margin-bottom":"8px"},attrs:{type:"primary"},on:{click:e.handleAddRole}},[e._v("添加角色")]),e._v(" "),n("el-table",{attrs:{data:e.list,border:""}},[n("el-table-column",{attrs:{align:"center",width:"234",prop:"name",label:"角色名"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"权限"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.title,(function(t,r){return n("el-tag",{key:r,staticStyle:{margin:"2px"}},[e._v(e._s(t))])}))}}])}),e._v(" "),n("el-table-column",{attrs:{wi:"",align:"center",width:"234",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(n){return e.handleEditRole(t.row)}}},[e._v("编辑角色权限")]),e._v(" "),n("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(n){return e.handleDeleteRole(t.row)}}},[e._v("删除角色")])]}}])})],1),e._v(" "),n("el-dialog",{attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,"destroy-on-close":!0,title:"add"===e.dialogType?"添加角色":"编辑角色"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-form",{attrs:{model:e.role,"label-width":"80px","label-position":"left"}},[n("el-form-item",{attrs:{label:"角色名"}},[n("el-input",{attrs:{maxlength:"12",placeholder:"角色名"},model:{value:e.role.name,callback:function(t){e.$set(e.role,"name",t)},expression:"role.name"}})],1),e._v(" "),n("div",{staticClass:"el-form-item-wrapper"},[n("el-form-item",{attrs:{label:"页面权限"}},[n("el-tree",{ref:"tree",staticClass:"permission-tree",attrs:{data:e.routes,props:{children:"children",label:"title"},"show-checkbox":"",accordion:"",indent:48,"icon-class":"el-icon-arrow-right","highlight-current":"","node-key":"path"},on:{"node-click":e.clickTree}})],1),e._v(" "),e.buttonPermission?n("el-form-item",{attrs:{label:"按钮权限"}},[n("el-table",{attrs:{data:e.buttonPermission,size:"mini","show-header":!1,stripe:"",border:""}},[n("el-table-column",{attrs:{align:"center",label:"按钮权限"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-switch",{model:{value:t.row.permission,callback:function(n){e.$set(t.row,"permission",n)},expression:"scope.row.permission"}})]}}],null,!1,2494243494)}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"按钮名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.name))]}}],null,!1,1895023226)})],1)],1):e._e()],1)],1),e._v(" "),n("div",{staticStyle:{"text-align":"right"}},[n("el-button",{attrs:{type:"danger"},on:{click:e.handleCloseDialog}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.confirmRole}},[e._v("确定")])],1)],1)],1)},i=[],o=(n("7514"),n("6762"),n("2fdb"),n("75fc")),l=n("db72"),a=(n("ac4d"),n("8a81"),n("7f7f"),n("4917"),n("ac6a"),n("df7c")),s=n.n(a),c=n("ed08"),u=n("cc5e"),d={name:"PageRoleManage",data:function(){return{role:{id:"",name:"",routes:[]},list:[],dialogType:"",dialogVisible:!1,buttonPermission:null,routes:this.generateRoutes(Object(c["b"])(this.$store.state.permission.routes))}},mounted:function(){this.getRole()},methods:{getRole:function(){var e=this;this.$request(Object(u["f"])(),(function(t){var n=t.list;n.forEach((function(e){e.title=JSON.stringify(e.routes).match(/(?<=title":").+?(?=")/g)})),"root"===e.$store.state.user.role?e.list=n.filter((function(e){return"root"!==e.name})):JSON.stringify(e.$store.state.user.routes).match("后台管理")?e.list=n.filter((function(e){return null===JSON.stringify(e.routes).match("后台管理")&&"root"!==e.name})):e.list=n}))},handleAddRole:function(){var e=this;this.role=Object.assign({},{id:"",name:"",routes:[]}),this.dialogType="add",this.$nextTick((function(){e.$refs.tree.setCheckedNodes([])})),this.dialogVisible=!0},handleEditRole:function(e){var t=this;this.dialogType="edit",this.role=Object(c["b"])(e);var n=function e(t,n){t.forEach((function(t){n.forEach((function(n){t.meta&&n.meta&&t.name===n.name&&(t.meta=n.meta),t.children&&n.children&&e(t.children,n.children)}))}))};n(this.routes,this.role.routes),this.dialogVisible=!0,this.$nextTick((function(){for(var e=t.generateArr(t.generateRoutes(t.role.routes)),n=e.length-1;n>=0;n--)e[n].children&&e.splice(n,1);t.$refs.tree.setCheckedNodes(e)}))},handleCloseDialog:function(){this.dialogVisible=!1,this.buttonPermission=null,this.routes=this.generateRoutes(Object(c["b"])(this.$store.state.permission.routes))},confirmRole:function(){var e=this;if(this.role.name){var t=this.$refs.tree.getCheckedKeys();this.role.routes=this.generateTree(Object(c["b"])(this.$store.state.permission.routes),"/",t),this.role.routes.forEach((function(e){e.component&&(e.component="")})),"edit"===this.dialogType?this.$request(Object(u["h"])(this.role),(function(t){e.$notify.success({title:"修改成功",message:"角色名: "+e.role.name}),e.getRole(),e.dialogVisible=!1}),{endStillLoading:!0}):"add"===this.dialogType&&this.$request(Object(u["b"])(this.role),(function(t){e.$notify.success({title:"添加成功",message:"角色名: "+e.role.name}),e.getRole(),e.dialogVisible=!1}),{endStillLoading:!0})}else this.$message.info({message:"请设置角色名"})},handleDeleteRole:function(e){var t=this,n=e.id;this.$confirm("确定要删除当前角色？","确定操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$request(Object(u["d"])({id:n}),(function(e){t.$message.success("删除成功"),t.getRole()}),{endStillLoading:!0})})).catch((function(e){return e}))},clickTree:function(e,t){var n=e.meta.buttonPermission;t.checked;this.buttonPermission=n||null},generateRoutes:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",n=[],r=!0,i=!1,o=void 0;try{for(var l,a=e[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var c=l.value;if(!c.hidden){var u=this.onlyOneShowingChild(c.children,c);c.children&&u&&!c.alwaysShow&&(c=u);var d={name:c.name,meta:c.meta||{},title:c.meta&&c.meta.title,path:s.a.resolve(t,c.path)};c.children&&(d.children=this.generateRoutes(c.children,d.path)),n.push(d)}}}catch(h){i=!0,o=h}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n},onlyOneShowingChild:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=null,r=e.filter((function(e){return!e.hidden}));return 1===r.length?(n=r[0],n.path=s.a.resolve(t.path,n.path),n):0===r.length&&(n=Object(l["a"])({},t,{path:"",noShowingChildren:!0}),n)},generateArr:function(e){var t=this,n=[];return e.forEach((function(e){if(n.push(e),e.children){var r=t.generateArr(e.children);r.length>0&&(n=[].concat(Object(o["a"])(n),Object(o["a"])(r)))}})),n},generateTree:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",r=arguments.length>2?arguments[2]:void 0,i=[],o=!0,l=!1,a=void 0;try{for(var c,u=function(){var e=c.value,o=s.a.resolve(n,e.path);e.children&&(e.children=t.generateTree(e.children,o,r)),(r.includes(o)||e.children&&e.children.length>=1)&&(e.meta=t.$refs.tree.getCheckedNodes().find((function(t){return t.name===e.name})).meta,i.push(e))},d=e[Symbol.iterator]();!(o=(c=d.next()).done);o=!0)u()}catch(h){l=!0,a=h}finally{try{o||null==d.return||d.return()}finally{if(l)throw a}}return i}}},h=d,f=(n("89ab"),n("2877")),m=Object(f["a"])(h,r,i,!1,null,"1864787e",null);t["default"]=m.exports},"89ab":function(e,t,n){"use strict";var r=n("e490"),i=n.n(r);i.a},cc5e:function(e,t,n){"use strict";n.d(t,"f",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"b",(function(){return l})),n.d(t,"h",(function(){return a})),n.d(t,"e",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return u})),n.d(t,"g",(function(){return d}));var r=n("b775"),i=function(e){return Object(r["a"])({url:"/role/all",method:"get",params:e})},o=function(e){return Object(r["a"])({url:"/role/del",method:"get",params:e})},l=function(e){return Object(r["a"])({url:"/role/add",method:"post",data:e})},a=function(e){return Object(r["a"])({url:"/role/update",method:"post",data:e})},s=function(e){return Object(r["a"])({url:"/account/all",method:"get",params:e})},c=function(e){return Object(r["a"])({url:"/account/del",method:"get",params:e})},u=function(e){return Object(r["a"])({url:"/account/add",method:"post",data:e})},d=function(e){return Object(r["a"])({url:"/account/update",method:"post",data:e})}},e490:function(e,t,n){}}]);